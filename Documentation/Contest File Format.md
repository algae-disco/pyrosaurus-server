
# CONT File Format

The CONT file is short for Contest. The file name is followed by three numbers starting at 000, example CONT.000 . This file is generated by the Contest Server from Team Entry files produced by players. 
The Contest file consists of five main data structures:
* Header
  * The header consists of a status byte and absolute file offsets to each of the data structures
* Player information
  * Includes User Id, team colors, and team name, player user name, and location
* Dino information
  * Includes species, Dino properties, initial map location and Dino names 
* Level information 
  * This is the normal level data structure
* Contest action data
  * This is the result of decision data simulated on the Contest Server. Includes everything from fighting moves to regular movements, neck movements, fire actions, and death as well

## Contest Header Structure
 
|Field|Size (bytes)|Position (hex)|Description
|--|--|--|--|	
|Contest Status|1|0|0=not watched, 83h=Draw, 81h=Won if first offset won, 82h=Won if second offset won, 80=Lost|
|Team 1 colors & strings|2|1||	
|Team 1 data|2|3||	
|Zeros|2|5||	
|Team 2 colors & strings|2|7||
|Team 2 data|2|9||
|Zeros|2|B||
|Level Data|2|D||
|Contest Data Offset|2|F|The actual contest data!!!|

## Team Information Data Structure

|Field|Size (bytes)|Description|
|--|--|--|
|Pyro User ID|4|Only include if it is equal to our Pyro User ID, otherwise it should be zeros|
|Marking and Skin Colors|C|0-99d||
|Fire Colors|6|0-99d||	
|Team Name|Zero terminated|When loading the contest menu page, Program checks Pyro User ID initially. Uses the enemy team name as the title. Later on, it checks this again, and prints the appropriate home team and enemy team names|
|Team Player Name|Zero terminated||
|Team Location|Zero terminated||

## Team Dino Data

|Field|Size (bytes)|Description|
|--|--|--|
|Num species|1||
|Species data|20h * num species||
|Total Dino’s|1||
|Queen Data|Num Dinos||
|Species leg type + straight/sprawling|Num Dino’s|	Changing the value here causes Leg changes when contest run
|Dino struct data|3 * num Dino’s|This data is in the actual contest entry as well|
|Team Dino X Pos|2 * Num Dinos||
|Team Dino Y Pos|2 * Num Dinos||
|Team Dino Rotation|2 * Num Dinos	
|Some Other Data|2 * Num Dinos||
|Dino Names|Zero Terminated, must be less than 50 chars|This logs the file offset of the Dino name and when the L key is pressed, looks up the name from the file|

## Contest Data Structure

The Contest Data is a series of Game Tick Frame Structures which encapsulate a set of Actions which were recorded from each Dino at that point-in-time. A Dino's action may or may not be included in any given Frame Structure. If too many frames with actions on the same dino are encountered in succession, they are "dropped" as an animation may still be running, causing the action data to be "out of sync" with what is happening on the screen. Manually tuned delays are included as a guideline for Contest AI. 
### Frame Structure
|Field|Size|Description|
|--|--|--|
|Number of Actions|1 byte|This is a counter of how many actions are in this structure. Does not include arguments in this number as they are consumed while the action is being handled||
|Actions|Number of Actions|This is an array of Action Structures with their arguments included as separate bytes, if required||

### Actions Structure
The Actions Structure within each Data Structure contains the following information
|Field|Size (bytes)|Description|
|--|--|--|
|Input_Byte|1|This is a single encoded byte which represents Dino_Index (0-9) and an Action (0-11). Together these select a Dino in the Contest Array and an Action to perform on that Dino||
|Arguments|Variable|Depending on the Action, there may be 0 or up to 2 arguments required||

### Encoding/Decoding Algorithm
Decoding algorithm has been reversed! It is straight forward so a simple encoding algorithm has been derived.

Dino_Index = a number between 0 and 9 relative to how many Dinos are actually included in the Contest data. Specifying a number outside of this range will not cause an error.

Action = a number between 0 and 11.

* Encoding Algorithm
  * Encoded_Byte = (Dino_Index * 12) + Action
* Decoding Algorithm
  * Dino_Index = floor(Encoded_Byte / 12)
  * Action = Encoded_Byte - (Dino_Index * 12)

### Dino Actions and Arguments
There are 12 actions available to perform on Dinos. This is a list of these actions, what they do (if known) and how many arguments (bytes) they require. There are no optional arguments, so an omitted argument will bring Contest Data reading out of alignment and cause Undefined Behavior.
|Action Code|Required Arguments|Description|Delay (frames)|Comments|
|--|--|--|--|--|
|0|1|Unknown| | ||
|1|2|Unknown| | ||
|2|2|Unknown| | ||
|3|2|Breathe| |The Dino's abdomen expands/contracts based on the arguments to simulate breathing and show Dino Status (Rested, Tired, etc)||
|4|1|Step Left/Right| |Causes selected Dino to do fighting step side-to-side and rotate based on supplied argument||
|5|1|Step Forward/Back| |Causes selected Dino to do fighting step forward or back and rotate based on supplied argument||
|6|1|Unknown| | ||
|7|1|Jump Left/Right|12|Causes selected Dino to do fighting jump side-to-side and rotate based on supplied argument||
|8|1|Jump Forward/Back|16|Causes selected Dino to do fighting jump forward or back and rotate based on the supplied argument||
|9|0|Unknown| |Updates the same byte array as Special Action 11-9 to 1||
|10|0|Call| |The Dino does a Call/Roar||
|11|1 (see comments)|Special Actions| |This is a special action which based on the argument selects a unique action. Special action 7 requires an additional argument||

### Special Actions
|Action Code|Argument Code|Description|Comments|
|--|--|--|--|
|11|0|Die|Causes the selected Dino to die||
|11|1|Unknown|Updates an internal game structure variable to (var AND 0xF) OR (1 * 16) ||
|11|2|Unknown|Updates an internal game structure variable to (var AND 0xF) OR (2 * 16)||
|11|3|Unknown|Updates an internal game structure variable to (var AND 0xF) OR (3 * 16)||
|11|4|Unknown|Updates an internal game structure variable to (var AND 0xF) OR (4 * 16)||
|11|5|Unknown|Updates an internal game structure variable to (var AND 0xF) OR (5 * 16)||
|11|6|Unknown|Updates an internal game structure variable to (var AND 0xF) OR (6 * 16)||
|11|7|Eat Food|REQUIRES ADDITIONAL ARGUMENT, possibly ID number for food piece to be removed?||
|11|8|Attack/Fire|This makes the Dino Attack by using its Fire||
|11|9|Unknown|Updates the same byte array as Action 9 to 0||
|11|10|No Operation (nop) frame|This is not specifically part of the code, however if any number above 9 is provided for the Argument Code, it will be ignored and no new actions will be kicked off for the frame, and the contest will not end prematurely. This is great to use if all delays are still ongoing or no Dino is making an action for a frame.||
